<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DeLucs PDF Merger – Browser Version</title>

  <!-- PDF-lib from CDN -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      color-scheme: dark;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #222 0, #111 50%, #050505 100%);
      color: #f5f5f5;
    }

    .app {
      width: 100%;
      max-width: 900px;
      padding: 2rem 1.5rem 2.5rem;
      box-sizing: border-box;
    }

    .card {
      background: rgba(18, 18, 18, 0.96);
      border-radius: 16px;
      padding: 1.75rem 1.75rem 2rem;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
    }

    h1 {
      margin: 0 0 0.25rem;
      font-size: 1.7rem;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin: 0 0 1.5rem;
      font-size: 0.95rem;
      opacity: 0.7;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.4fr);
      gap: 1.25rem;
    }

    @media (max-width: 760px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .dropzone {
      border-radius: 12px;
      border: 1px dashed rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.02);
      padding: 1.2rem 1rem;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.15s ease, background-color 0.15s ease,
        transform 0.08s ease;
      user-select: none;
    }

    .dropzone.dragover {
      border-color: #4f9cff;
      background: rgba(79, 156, 255, 0.06);
      transform: translateY(-1px);
    }

    .dropzone-title {
      font-size: 0.98rem;
      margin-bottom: 0.25rem;
    }

    .dropzone-hint {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .file-input {
      display: none;
    }

    .file-list-container {
      margin-top: 1rem;
      max-height: 260px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(0, 0, 0, 0.25);
    }

    .file-list-empty {
      padding: 0.8rem 1rem;
      font-size: 0.85rem;
      opacity: 0.65;
    }

    ul.file-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.55rem 0.85rem;
      font-size: 0.88rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 0.75rem;
    }

    .file-size {
      font-size: 0.78rem;
      opacity: 0.7;
      margin-right: 0.75rem;
      white-space: nowrap;
    }

    .file-actions {
      display: flex;
      gap: 0.25rem;
    }

    .btn-icon {
      border: none;
      padding: 0.25rem 0.4rem;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.04);
      color: #f5f5f5;
      cursor: pointer;
      font-size: 0.8rem;
      line-height: 1;
      transition: background-color 0.12s ease, transform 0.06s ease;
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.14);
      transform: translateY(-0.5px);
    }

    .btn-icon.danger {
      color: #ff8383;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      height: 100%;
    }

    .section-title {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 0.3rem;
    }

    .merge-options {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .merge-options label {
      display: block;
      margin-bottom: 0.3rem;
    }

    .input-text {
      width: 100%;
      padding: 0.45rem 0.6rem;
      font-size: 0.85rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.13);
      background: rgba(255, 255, 255, 0.02);
      color: inherit;
      box-sizing: border-box;
    }

    .input-text:focus {
      outline: none;
      border-color: #4f9cff;
      box-shadow: 0 0 0 1px rgba(79, 156, 255, 0.4);
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 0.7rem 1.6rem;
      font-size: 0.9rem;
      background: linear-gradient(135deg, #4f9cff, #2dd4bf);
      color: #04101a;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      box-shadow: 0 12px 25px rgba(79, 156, 255, 0.35);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        filter 0.12s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 14px 30px rgba(79, 156, 255, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.45;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .status {
      font-size: 0.8rem;
      opacity: 0.8;
      min-height: 1.2em;
    }

    .status.error {
      color: #ff8f8f;
      opacity: 1;
    }

    .status.success {
      color: #4ade80;
      opacity: 1;
    }

    .footer {
      margin-top: 1.5rem;
      font-size: 0.78rem;
      opacity: 0.6;
      text-align: right;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 999px;
      background: rgba(79, 156, 255, 0.14);
      border: 1px solid rgba(79, 156, 255, 0.45);
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #4ade80;
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.15);
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>DeLucs PDF Merger</h1>
      <p class="subtitle">
        Browser-only PDF merger &mdash; drop your files, reorder them, and
        download a merged PDF. All processing happens locally in your browser.
      </p>

      <div class="grid">
        <!-- Left side: file selection & list -->
        <div>
          <div
            class="dropzone"
            id="dropzone"
            title="Click to select PDFs or drop them here"
          >
            <div class="dropzone-title">
              Click or drop PDF files here
            </div>
            <div class="dropzone-hint">
              Multiple files allowed • Held locally • No upload
            </div>
          </div>
          <input
            type="file"
            id="fileInput"
            class="file-input"
            accept="application/pdf"
            multiple
          />

          <div class="file-list-container" id="fileListContainer">
            <div class="file-list-empty" id="fileListEmpty">
              No files selected yet. Add at least two PDFs to start.
            </div>
            <ul class="file-list" id="fileList" hidden></ul>
          </div>
        </div>

        <!-- Right side: merge options & actions -->
        <div class="controls">
          <div>
            <div class="section-title">Output</div>
            <div class="merge-options">
              <label>
                File name
                <input
                  type="text"
                  id="outputName"
                  class="input-text"
                  value="merged.pdf"
                />
              </label>
            </div>
          </div>

          <div>
            <div class="section-title">Merge</div>
            <button id="mergeButton" class="btn-primary" disabled>
              <span>Merge PDFs</span>
              <span id="mergeButtonLabel"></span>
            </button>
          </div>

          <div class="status" id="status"></div>
        </div>
      </div>

      <div class="footer">
        <span class="badge">
          <span class="badge-dot"></span>
          client-side only • powered by PDF-lib
        </span>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const { PDFDocument } = PDFLib;

      /** @type {{ id: string, file: File }[]} */
      let files = [];

      const dropzone = document.getElementById("dropzone");
      const fileInput = document.getElementById("fileInput");
      const fileList = document.getElementById("fileList");
      const fileListContainer = document.getElementById("fileListContainer");
      const fileListEmpty = document.getElementById("fileListEmpty");
      const mergeButton = document.getElementById("mergeButton");
      const mergeButtonLabel = document.getElementById("mergeButtonLabel");
      const outputNameInput = document.getElementById("outputName");
      const status = document.getElementById("status");

      function formatBytes(bytes) {
        if (!Number.isFinite(bytes) || bytes <= 0) return "";
        const units = ["B", "KB", "MB", "GB"];
        let i = 0;
        let val = bytes;
        while (val >= 1024 && i < units.length - 1) {
          val /= 1024;
          i++;
        }
        return `${val.toFixed(1)} ${units[i]}`;
      }

      function setStatus(message, type = "") {
        status.textContent = message || "";
        status.classList.remove("error", "success");
        if (type) status.classList.add(type);
      }

      function updateMergeButtonState() {
        mergeButton.disabled = files.length < 2;
        mergeButtonLabel.textContent = files.length
          ? `(${files.length} file${files.length > 1 ? "s" : ""})`
          : "";
      }

      function renderFileList() {
        if (!files.length) {
          fileList.hidden = true;
          fileListEmpty.hidden = false;
          fileListEmpty.textContent =
            "No files selected yet. Add at least two PDFs to start.";
          updateMergeButtonState();
          return;
        }

        fileList.innerHTML = "";
        files.forEach((entry, idx) => {
          const li = document.createElement("li");
          li.className = "file-item";
          li.dataset.id = entry.id;

          const nameSpan = document.createElement("span");
          nameSpan.className = "file-name";
          nameSpan.textContent = entry.file.name;

          const sizeSpan = document.createElement("span");
          sizeSpan.className = "file-size";
          sizeSpan.textContent = formatBytes(entry.file.size);

          const actions = document.createElement("div");
          actions.className = "file-actions";

          const upBtn = document.createElement("button");
          upBtn.className = "btn-icon";
          upBtn.textContent = "↑";
          upBtn.title = "Move up";
          upBtn.dataset.action = "up";

          const downBtn = document.createElement("button");
          downBtn.className = "btn-icon";
          downBtn.textContent = "↓";
          downBtn.title = "Move down";
          downBtn.dataset.action = "down";

          const removeBtn = document.createElement("button");
          removeBtn.className = "btn-icon danger";
          removeBtn.textContent = "✕";
          removeBtn.title = "Remove";
          removeBtn.dataset.action = "remove";

          if (idx === 0) upBtn.disabled = true;
          if (idx === files.length - 1) downBtn.disabled = true;

          actions.appendChild(upBtn);
          actions.appendChild(downBtn);
          actions.appendChild(removeBtn);

          li.appendChild(nameSpan);
          li.appendChild(sizeSpan);
          li.appendChild(actions);
          fileList.appendChild(li);
        });

        fileList.hidden = false;
        fileListEmpty.hidden = true;
        updateMergeButtonState();
      }

      function addFilesFromFileList(fileListLike) {
        const added = [];
        for (const file of fileListLike) {
          if (file.type === "application/pdf" || file.name.toLowerCase().endsWith(".pdf")) {
            const id = `${Date.now()}-${Math.random().toString(16).slice(2)}`;
            files.push({ id, file });
            added.push(file.name);
          }
        }
        if (added.length) {
          setStatus(`Added ${added.length} PDF file(s).`, "success");
        } else if (!files.length) {
          setStatus("No valid PDF files were added.", "error");
        }
        renderFileList();
      }

      // Dropzone events
      dropzone.addEventListener("click", () => fileInput.click());

      dropzone.addEventListener("dragover", (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add("dragover");
      });

      dropzone.addEventListener("dragleave", (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove("dragover");
      });

      dropzone.addEventListener("drop", (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove("dragover");
        const dtFiles = e.dataTransfer?.files;
        if (dtFiles && dtFiles.length) {
          addFilesFromFileList(dtFiles);
        }
      });

      // File input change
      fileInput.addEventListener("change", (e) => {
        const inputFiles = e.target.files;
        if (inputFiles && inputFiles.length) {
          addFilesFromFileList(inputFiles);
          fileInput.value = "";
        }
      });

      // Reorder / remove via event delegation
      fileList.addEventListener("click", (e) => {
        const btn = e.target;
        if (!(btn instanceof HTMLButtonElement)) return;
        const action = btn.dataset.action;
        if (!action) return;

        const li = btn.closest(".file-item");
        if (!li) return;
        const id = li.dataset.id;
        const index = files.findIndex((f) => f.id === id);
        if (index === -1) return;

        if (action === "remove") {
          files.splice(index, 1);
          renderFileList();
          setStatus("Removed file from list.");
        } else if (action === "up" && index > 0) {
          const tmp = files[index - 1];
          files[index - 1] = files[index];
          files[index] = tmp;
          renderFileList();
          setStatus("Moved file up.");
        } else if (action === "down" && index < files.length - 1) {
          const tmp = files[index + 1];
          files[index + 1] = files[index];
          files[index] = tmp;
          renderFileList();
          setStatus("Moved file down.");
        }
      });

      // Merge handler
      mergeButton.addEventListener("click", async () => {
        if (files.length < 2) {
          setStatus("Add at least two PDF files to merge.", "error");
          return;
        }

        const rawName = (outputNameInput.value || "").trim();
        const outputName = rawName || "merged.pdf";

        setStatus("Merging PDFs, please wait...");
        mergeButton.disabled = true;

        try {
          const mergedPdf = await PDFDocument.create();

          for (let i = 0; i < files.length; i++) {
            const entry = files[i];
            const arrayBuffer = await entry.file.arrayBuffer();
            const srcPdf = await PDFDocument.load(arrayBuffer);
            const copiedPages = await mergedPdf.copyPages(
              srcPdf,
              srcPdf.getPageIndices()
            );
            copiedPages.forEach((page) => mergedPdf.addPage(page));
          }

          const mergedBytes = await mergedPdf.save();
          const blob = new Blob([mergedBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);

          const a = document.createElement("a");
          a.href = url;
          a.download = outputName.toLowerCase().endsWith(".pdf")
            ? outputName
            : `${outputName}.pdf`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);

          setStatus("Merge complete. Your PDF has been downloaded.", "success");
        } catch (err) {
          console.error(err);
          setStatus(
            "An error occurred while merging. Check the console for details.",
            "error"
          );
        } finally {
          mergeButton.disabled = files.length < 2;
        }
      });

      // Initial UI state
      renderFileList();
      setStatus("Ready. Add some PDFs to begin.");
    })();
  </script>
</body>
</html>
